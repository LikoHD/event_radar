# Tea Event Radar

一个用于监控和分析网页埋点上报信息的Chrome插件。

## 项目简介

Tea Event Radar 是一个专为监控网页埋点数据设计的Chrome浏览器扩展，它能够实时捕获网页上报的埋点信息，并以清晰直观的方式展示在浏览器侧边栏中。通过这个工具，开发人员和测试人员可以轻松查看和分析页面上的埋点事件，提高调试效率。

## 功能特点

- **实时监控**：捕获网页中的埋点上报请求（主要针对包含"list"的POST请求）
- **侧边栏展示**：在浏览器侧边栏中展示埋点事件列表，不干扰正常浏览
- **时间序列展示**：按照时间顺序排列的卡片式列表，清晰展示事件流
- **详细信息查看**：
  - 事件名称和时间戳
  - 用户信息展示
  - 请求状态指示（成功/失败）
- **信息展开功能**：点击卡片可展开查看更多信息：
  - 事件详情：events列表及其参数的优化展示
  - 请求基本信息：URL、状态码等
  - 原始JSON数据：格式化展示，便于分析
- **搜索过滤**：支持关键词搜索，可同时使用多个关键词进行模糊匹配
- **操作控制**：开始/暂停捕获功能，灵活控制监控状态

## 安装方法

### 开发模式安装
1. 下载或克隆本仓库到本地
2. 打开Chrome浏览器，进入扩展程序页面（chrome://extensions/）
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择本项目的`tea_event_radar`文件夹

## 使用方法

1. 安装插件后，点击浏览器工具栏中的Tea Event Radar图标
2. 插件会在浏览器右侧打开侧边栏面板
3. 点击"开始"按钮开始捕获埋点数据
4. 浏览网页，插件会自动捕获并展示埋点上报信息
5. 点击任意卡片可展开查看详细信息
6. 使用顶部搜索框可按关键词过滤事件列表
7. 点击"暂停"按钮可暂停捕获
8. 点击"清除"按钮可清除已捕获的数据

## 数据格式说明

插件主要捕获包含"list"的POST请求，并解析其中的埋点数据。典型的埋点数据结构如下：

```json
[{
  "events": [
    {
      "event": "埋点事件名称",
      "params": "{\"user\":\"用户名\", ...其他参数...}",
      "local_time_ms": 时间戳
    },
    ...更多事件...
  ],
  "user": {
    "user_unique_id": "用户ID"
  },
  "header": {
    // 请求头信息
  }
}]
```

## 技术实现

- 使用Chrome Extension Manifest V3规范开发
- 通过webRequest API拦截并分析网络请求
- 使用侧边栏(Side Panel)API提供友好的用户界面
- 采用原生JavaScript实现，无需额外依赖

## 注意事项

- 插件需要获取网页请求权限才能正常工作
- 只有在点击"开始"按钮后才会开始捕获数据
- 建议在不需要时点击"暂停"按钮，以避免捕获过多数据影响性能
- 目前主要针对特定格式的埋点请求进行解析，可能需要根据实际使用场景调整

## 更新日志

### v1.1 - 中文字符解码优化
- ✅ 修复了参数中中文字符显示为乱码的问题（如 `éç½®åå¸` 显示为正确的中文）
- ✅ 改进了请求体解析，优先使用 UTF-8 解码
- ✅ 添加了多种解码方式的回退机制
- ✅ 支持 URL 编码、Latin-1 到 UTF-8 转换等多种编码格式
- ✅ 递归解码对象中的所有字符串值，确保完整的中文显示

### v1.2 - 剪贴板权限优化
- ✅ 添加了多层复制回退机制：现代剪贴板API → execCommand → 手动复制模态框
- ✅ 当自动复制失败时，会弹出模态框供用户手动选择复制内容
- ✅ 改进了复制功能的用户体验和错误处理
- ✅ 添加了 `clipboardWrite` 权限以支持更好的剪贴板访问 